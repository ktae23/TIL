# LLM 프롬프트 엔지니어링

LLM(Large Language Model)을 효과적으로 활용하기 위한 프롬프트 설계 기법과 실무 베스트 프랙티스를 정리합니다. 기본 패턴부터 문서 OCR 정확도 향상을 위한 고급 기법까지 다룹니다.

## 목차

1. [기본 프롬프트 패턴](#1-기본-프롬프트-패턴)
2. [시스템 프롬프트 설계](#2-시스템-프롬프트-설계)
3. [문서 OCR 정확도 향상 베스트 프랙티스](#3-문서-ocr-정확도-향상-베스트-프랙티스)
4. [일관성 확보 전략](#4-일관성-확보-전략)

---

## 1. 기본 프롬프트 패턴

### 1.1 Zero-shot Prompting

사전 예시 없이 직접 지시만으로 작업을 수행하는 방식입니다.

**특징:**
- 가장 단순한 형태의 프롬프트
- 모델의 사전 학습된 지식에 의존
- 단순하고 명확한 작업에 적합

**예시:**
```
다음 텍스트의 감정을 분석해주세요: "오늘 날씨가 정말 좋아서 기분이 좋다"
```

**적합한 상황:**
- 일반적이고 널리 알려진 작업
- 명확한 지시가 가능한 경우
- 빠른 프로토타이핑

### 1.2 Few-shot Prompting

몇 가지 예시를 제공하여 모델이 패턴을 학습하도록 유도하는 방식입니다.

**특징:**
- 예시를 통해 원하는 출력 형식을 명확히 전달
- Zero-shot 대비 정확도 향상
- 도메인 특화 작업에 효과적

**예시:**
```
다음은 텍스트 감정 분석 예시입니다:

텍스트: "이 제품 정말 최고예요!"
감정: 긍정

텍스트: "배송이 너무 늦어서 실망했습니다"
감정: 부정

텍스트: "그냥 평범한 제품이에요"
감정: 중립

텍스트: "서비스가 친절하고 품질도 좋았습니다"
감정:
```

**Best Practice:**
- 예시는 3-5개가 적당 (너무 많으면 컨텍스트 낭비)
- 다양한 케이스를 커버하는 예시 선정
- 예시의 형식을 일관되게 유지

### 1.3 Chain of Thought (CoT) Prompting

모델이 단계별로 사고 과정을 거쳐 답변하도록 유도하는 방식입니다.

**특징:**
- 복잡한 추론 문제에서 정확도 대폭 향상
- 모델의 사고 과정을 투명하게 확인 가능
- 디버깅과 검증이 용이

**기본 CoT 예시:**
```
문제: 철수는 사과 5개를 가지고 있었습니다. 영희에게 2개를 주고,
시장에서 3개를 더 샀습니다. 철수는 지금 사과를 몇 개 가지고 있나요?

단계별로 생각해봅시다:
1. 처음 가지고 있던 사과: 5개
2. 영희에게 준 후: 5 - 2 = 3개
3. 시장에서 산 후: 3 + 3 = 6개

따라서 철수는 6개의 사과를 가지고 있습니다.
```

**Zero-shot CoT:**
```
다음 문제를 단계별로 생각하여 풀어주세요.
(Let's think step by step)
```

### 1.4 Self-Consistency

동일한 질문에 대해 여러 번 추론하고 가장 일관된 답을 선택하는 방식입니다.

**구현 방법:**
1. 동일한 프롬프트로 여러 번 (보통 3-5회) 응답 생성
2. Temperature를 약간 높여 다양성 확보 (0.5-0.7)
3. 다수결 또는 가중 투표로 최종 답변 결정

**적합한 상황:**
- 높은 정확도가 요구되는 작업
- 계산이나 추론이 포함된 문제
- 비용보다 정확도가 중요한 경우

### 1.5 ReAct (Reasoning + Acting)

추론과 행동을 번갈아 수행하며 외부 도구를 활용하는 패턴입니다.

**구조:**
```
Thought: 현재 상황 분석 및 다음 행동 계획
Action: 수행할 작업 (검색, 계산 등)
Observation: 행동의 결과
... (반복)
Final Answer: 최종 답변
```

---

## 2. 시스템 프롬프트 설계

### 2.1 시스템 프롬프트의 역할

시스템 프롬프트는 모델의 전반적인 행동 방식, 페르소나, 제약 조건을 정의합니다.

**핵심 구성 요소:**

| 구성 요소 | 설명 | 예시 |
|----------|------|------|
| 역할 정의 | 모델이 수행할 역할 | "당신은 전문 번역가입니다" |
| 행동 지침 | 응답 방식 규칙 | "항상 공손하게 응답합니다" |
| 제약 조건 | 하지 말아야 할 것 | "개인정보를 요청하지 않습니다" |
| 출력 형식 | 응답 포맷 | "JSON 형식으로 응답합니다" |

### 2.2 효과적인 시스템 프롬프트 구조

```
# 역할 및 목적
당신은 [역할]입니다. 주요 목적은 [목적]입니다.

# 핵심 능력
- 능력 1
- 능력 2
- 능력 3

# 응답 규칙
1. [규칙 1]
2. [규칙 2]
3. [규칙 3]

# 제약 사항
- [제약 1]
- [제약 2]

# 출력 형식
[원하는 출력 형식 명시]
```

### 2.3 시스템 프롬프트 작성 원칙

**1. 명확성 (Clarity)**
```
❌ 좋은 응답을 해주세요
✅ 모든 응답은 3문장 이내로 작성하고, 전문 용어 사용 시 괄호 안에 설명을 추가합니다
```

**2. 구체성 (Specificity)**
```
❌ 친절하게 대답하세요
✅ 모든 응답의 시작은 "안녕하세요,"로 시작하고,
   끝에는 "추가 질문이 있으시면 말씀해주세요"를 포함합니다
```

**3. 우선순위 명시**
```
다음 우선순위로 응답합니다:
1. 정확성: 불확실한 정보는 "확인이 필요합니다"라고 명시
2. 간결성: 핵심 내용을 먼저 전달
3. 실용성: 바로 적용 가능한 예시 포함
```

---

## 3. 문서 OCR 정확도 향상 베스트 프랙티스

LLM의 비전 기능을 활용한 문서 텍스트 인식에서 정확도를 높이는 실무 기법입니다.

### 3.1 이미지 전처리

**해상도 최적화:**
- 최소 150 DPI 이상 권장 (300 DPI 최적)
- 이미지 크기: 긴 변 기준 1500-2000px 권장
- 너무 큰 이미지는 리사이즈하여 처리 속도 개선

**이미지 품질 개선:**
```python
# 전처리 예시
from PIL import Image, ImageEnhance

def preprocess_image(image_path):
    img = Image.open(image_path)

    # 1. 그레이스케일 변환 (텍스트 인식에 유리)
    img = img.convert('L')

    # 2. 대비 향상
    enhancer = ImageEnhance.Contrast(img)
    img = enhancer.enhance(1.5)

    # 3. 선명도 향상
    enhancer = ImageEnhance.Sharpness(img)
    img = enhancer.enhance(2.0)

    return img
```

### 3.2 프롬프트 설계 전략

**구조화된 추출 지시:**
```
이 문서 이미지에서 다음 정보를 추출해주세요:

## 추출 규칙
1. 텍스트를 있는 그대로 정확히 읽어주세요
2. 불분명한 글자는 [불명확] 표시
3. 표가 있는 경우 마크다운 표 형식으로 변환
4. 빈 칸이나 체크박스는 □(미체크) 또는 ☑(체크)로 표시

## 출력 형식
{
  "title": "문서 제목",
  "date": "날짜",
  "content": "본문 내용",
  "tables": [...],
  "confidence": "high/medium/low"
}
```

**영역별 분할 처리:**
```
이 문서를 다음 영역으로 나누어 분석해주세요:

1. 헤더 영역 (상단 20%): 제목, 날짜, 문서번호
2. 본문 영역 (중앙 60%): 주요 내용
3. 푸터 영역 (하단 20%): 서명, 직인, 페이지 번호

각 영역별로 추출된 텍스트를 구분하여 제공해주세요.
```

### 3.3 정확도 향상 기법

**1. 이중 검증 (Double Verification)**
```
## 1차 추출
이미지의 텍스트를 추출해주세요.

## 2차 검증
추출한 텍스트를 다시 이미지와 비교하여:
- 오탈자 가능성이 있는 부분 표시
- 숫자의 정확성 재확인
- 날짜 형식 검증
```

**2. 맥락 기반 보정:**
```
이 문서는 [문서 유형]입니다.

다음 도메인 지식을 참고하여 텍스트를 보정해주세요:
- 회사명은 "ABC주식회사"입니다
- 날짜 형식은 YYYY년 MM월 DD일 입니다
- 금액은 원화(₩) 단위입니다

추출된 텍스트 중 위 정보와 맞지 않는 부분은 재검토해주세요.
```

**3. 특정 필드 집중 추출:**
```
이 영수증 이미지에서 다음 필드만 정확히 추출해주세요:

| 필드 | 위치 힌트 | 형식 |
|-----|---------|------|
| 총금액 | 하단, "합계" 옆 | 숫자만 (쉼표 포함 가능) |
| 날짜 | 상단 | YYYY-MM-DD |
| 상호명 | 최상단 | 텍스트 |

각 필드의 confidence score (0-100)도 함께 제공해주세요.
```

### 3.4 편차 줄이기 전략

**Temperature 설정:**
- OCR 작업: `temperature: 0` 권장 (결정적 출력)
- 창의적 해석 불필요한 작업에서는 낮은 temperature 유지

**출력 형식 고정:**
```json
{
  "extracted_text": "추출된 원본 텍스트",
  "structured_data": {
    "field1": "value1",
    "field2": "value2"
  },
  "metadata": {
    "confidence": 0.95,
    "unclear_sections": ["2번째 줄 3번째 단어"],
    "processing_notes": "우측 상단 일부 잘림"
  }
}
```

---

## 4. 일관성 확보 전략

### 4.1 출력 스키마 정의

**JSON Schema 활용:**
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["result", "confidence"],
  "properties": {
    "result": {
      "type": "string",
      "description": "추출된 텍스트"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    }
  }
}
```

### 4.2 검증 레이어 구축

**다단계 검증 파이프라인:**

```
[이미지 입력]
    ↓
[1차 추출] → LLM (temperature: 0)
    ↓
[형식 검증] → JSON Schema 검증
    ↓
[내용 검증] → 비즈니스 규칙 체크
    ↓
[2차 확인] → 불확실 항목 재처리
    ↓
[최종 출력]
```

### 4.3 에러 처리 전략

**Fallback 체인:**
```
1차 시도: GPT-4 Vision
    ↓ (실패 시)
2차 시도: 이미지 전처리 후 재시도
    ↓ (실패 시)
3차 시도: 이미지 분할 후 부분 처리
    ↓ (실패 시)
수동 검토 대기열로 이동
```

**불확실성 표현:**
```
다음 규칙으로 불확실한 부분을 표시해주세요:

- 확실함: 그대로 출력
- 불확실함 (70-90% 확신): 텍스트 뒤에 (?) 표시
- 매우 불확실함 (50-70%): [추정: 텍스트] 형식
- 인식 불가 (<50%): [인식불가] 표시
```

### 4.4 실무 체크리스트

| 항목 | 확인 사항 |
|-----|----------|
| 이미지 품질 | 해상도, 조명, 기울기 보정 |
| 프롬프트 | 구체적 지시, 출력 형식 명시 |
| 파라미터 | temperature: 0, 적절한 max_tokens |
| 검증 | 스키마 검증, 비즈니스 규칙 체크 |
| 에러 처리 | Fallback 로직, 재시도 전략 |
| 모니터링 | 정확도 지표, 실패율 추적 |

---

## 참고 자료

- [OpenAI Prompt Engineering Guide](https://platform.openai.com/docs/guides/prompt-engineering)
- [Anthropic Claude Documentation](https://docs.anthropic.com/)
- [Chain-of-Thought Prompting Paper](https://arxiv.org/abs/2201.11903)

---

*마지막 업데이트: 2024년 12월*
