# Java Virtual Threads ì™„ë²½ ê°€ì´ë“œ

---

## ëª©ì°¨

1. [ê°œìš” ë° ì—­ì‚¬](#1-ê°œìš”-ë°-ì—­ì‚¬)
2. [í•µì‹¬ ê°œë…](#2-í•µì‹¬-ê°œë…)
   - [2.4 ì‹¤ì œ ë™ì‘ í”Œë¡œìš° (I/O Bound ì‘ì—…)](#24-ì‹¤ì œ-ë™ì‘-í”Œë¡œìš°-io-bound-ì‘ì—…)
3. [ê¸°ë³¸ ì‚¬ìš©ë²•](#3-ê¸°ë³¸-ì‚¬ìš©ë²•)
4. [Spring Bootì—ì„œì˜ í™œìš©](#4-spring-bootì—ì„œì˜-í™œìš©)
5. [Pinning ë¬¸ì œì™€ í•´ê²°](#5-pinning-ë¬¸ì œì™€-í•´ê²°)
6. [ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤](#6-ë² ìŠ¤íŠ¸-í”„ë™í‹°ìŠ¤)
7. [ì„±ëŠ¥ ë° ëª¨ë‹ˆí„°ë§](#7-ì„±ëŠ¥-ë°-ëª¨ë‹ˆí„°ë§)
8. [ì°¸ê³  ìë£Œ](#8-ì°¸ê³ -ìë£Œ)

---

## 1. ê°œìš” ë° ì—­ì‚¬

### 1.1 Virtual Threadsë€?

Virtual Threads(ê°€ìƒ ìŠ¤ë ˆë“œ)ëŠ” **JDKê°€ ì œê³µí•˜ëŠ” ê²½ëŸ‰ ìŠ¤ë ˆë“œ**ë¡œ, ìš´ì˜ì²´ì œ(OS)ê°€ ì•„ë‹Œ JVMì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤. ê¸°ì¡´ Platform Thread(í”Œë«í¼ ìŠ¤ë ˆë“œ)ì™€ ë‹¬ë¦¬ ìˆ˜ë°±ë§Œ ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•´ë„ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ ê±°ì˜ ì†Œëª¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 1.2 ë¦´ë¦¬ìŠ¤ íˆìŠ¤í† ë¦¬

| ë²„ì „ | JEP | ìƒíƒœ | ì£¼ìš” ë³€ê²½ì‚¬í•­ |
|------|-----|------|---------------|
| **JDK 19** | JEP 425 | Preview 1 | ìµœì´ˆ ë„ì… |
| **JDK 20** | JEP 436 | Preview 2 | í”¼ë“œë°± ë°˜ì˜ ê°œì„  |
| **JDK 21 (LTS)** | JEP 444 | **ì •ì‹ ë¦´ë¦¬ìŠ¤** | Thread-local ë³€ìˆ˜ ì™„ì „ ì§€ì›, JNI `IsVirtualThread` í•¨ìˆ˜ ì¶”ê°€ |
| **JDK 24** | JEP 491 | ì •ì‹ ë¦´ë¦¬ìŠ¤ | synchronized ë¸”ë¡ Pinning ë¬¸ì œ í•´ê²° |

### 1.3 ì™œ Virtual Threadsì¸ê°€?

ê¸°ì¡´ Platform Threadì˜ í•œê³„:

```
Platform Thread = OS Thread (1:1 ë§¤í•‘)
- ìŠ¤ë ˆë“œë‹¹ ë©”ëª¨ë¦¬: 2~10MB
- 100ë§Œ ìŠ¤ë ˆë“œ = ìµœì†Œ 2TB ë©”ëª¨ë¦¬ í•„ìš”
- ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë¹„ìš© ë†’ìŒ
```

Virtual Threadì˜ í•´ê²°ì±…:

```
Virtual Thread = JVM ê´€ë¦¬ ê²½ëŸ‰ ìŠ¤ë ˆë“œ (M:N ë§¤í•‘)
- ìŠ¤ë ˆë“œë‹¹ ë©”ëª¨ë¦¬: ìˆ˜ KB
- 100ë§Œ ìŠ¤ë ˆë“œë„ ìˆ˜ GBë¡œ ê°€ëŠ¥
- Carrier Thread(Platform Thread) ìœ„ì—ì„œ ì‹¤í–‰
```

---

## 2. í•µì‹¬ ê°œë…

### 2.1 ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Virtual Threads                        â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”    â”‚
â”‚  â”‚VT1â”‚ â”‚VT2â”‚ â”‚VT3â”‚ â”‚VT4â”‚ â”‚VT5â”‚ â”‚VT6â”‚ â”‚VT7â”‚ â”‚VT8â”‚ â”‚...â”‚    â”‚
â”‚  â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”¬â”€â”˜ â””â”€â”€â”€â”˜    â”‚
â”‚    â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                â”‚                 â”‚                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                    â”‚
â”‚          â”‚ Carrier 1 â”‚     â”‚ Carrier 2 â”‚  â† Platform Threadsâ”‚
â”‚          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                â”‚                 â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                 â”‚
           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
           â”‚ OS Thread â”‚     â”‚ OS Thread â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ì£¼ìš” íŠ¹ì§•

| íŠ¹ì„± | Platform Thread | Virtual Thread |
|------|-----------------|----------------|
| ê´€ë¦¬ ì£¼ì²´ | OS | JVM |
| ìƒì„± ë¹„ìš© | ë†’ìŒ (ìˆ˜ ms) | ë‚®ìŒ (ìˆ˜ Î¼s) |
| ë©”ëª¨ë¦¬ | 2~10MB | ìˆ˜ KB |
| ìµœëŒ€ ê°œìˆ˜ | ìˆ˜ì²œ ê°œ | ìˆ˜ë°±ë§Œ ê°œ |
| Blocking I/O | ìŠ¤ë ˆë“œ ì ìœ  | Carrier ë°˜í™˜ |
| í’€ë§ í•„ìš” | í•„ìˆ˜ | ë¶ˆí•„ìš” |

### 2.3 ì í•©í•œ ì‚¬ìš© ì¼€ì´ìŠ¤

**ì í•©í•œ ê²½ìš°:**
- I/O ë°”ìš´ë“œ ì‘ì—… (ë„¤íŠ¸ì›Œí¬, íŒŒì¼, DB í†µì‹ )
- ëŒ€ëŸ‰ì˜ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ (ì›¹ ì„œë²„)
- Blocking API ì‚¬ìš© ì‹œ

**ë¶€ì í•©í•œ ê²½ìš°:**
- CPU ì§‘ì•½ì  ì‘ì—… â†’ Parallel Stream, ForkJoinPool ì‚¬ìš©
- ì´ë¯¸ ë¹„ë™ê¸°ë¡œ ì˜ êµ¬í˜„ëœ ì‹œìŠ¤í…œ

### 2.4 ì‹¤ì œ ë™ì‘ í”Œë¡œìš° (I/O Bound ì‘ì—…)

#### Mount/Unmount ë©”ì»¤ë‹ˆì¦˜

Virtual Threadì˜ í•µì‹¬ì€ I/O ë¸”ë¡œí‚¹ ì‹œ **Carrier Threadì—ì„œ ìë™ìœ¼ë¡œ ë¶„ë¦¬(Unmount)**ë˜ì–´ ë‹¤ë¥¸ Virtual Threadê°€ í•´ë‹¹ Carrierë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

```
ì‹œê°„ â†’

Virtual Thread 1 (API í˜¸ì¶œ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[ì‹¤í–‰]        [I/O ëŒ€ê¸°]                              [ì‹¤í–‰]
â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–“
 â†‘              â†‘                                      â†‘
 Mount          Unmount                               Mount
 (CT1ì— íƒ‘ìŠ¹)    (CT1ì—ì„œ í•˜ì°¨, í™ì— ì €ì¥)              (CT2ì— íƒ‘ìŠ¹)


Carrier Thread 1
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[VT1 ì‹¤í–‰] [VT2 ì‹¤í–‰] [VT3 ì‹¤í–‰]    [VT4 ì‹¤í–‰]   [VT5 ì‹¤í–‰]
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
       â†‘           â†‘           â†‘           â†‘
       VT1 í•˜ì°¨    VT2 í•˜ì°¨     VT3 í•˜ì°¨    ...
       VT2 íƒ‘ìŠ¹    VT3 íƒ‘ìŠ¹     VT4 íƒ‘ìŠ¹
```

#### ì‹¤ì œ ì˜ˆì‹œ: 6ê±´ ì´ë¯¸ì§€ API ë³‘ë ¬ ì²˜ë¦¬

ì™¸ë¶€ API í˜¸ì¶œ(ì•½ 18ì´ˆ ì†Œìš”)ì„ 6ê±´ ë³‘ë ¬ ì²˜ë¦¬í•˜ëŠ” ìƒí™©:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Virtual Thread ìƒì„± (ì¦‰ì‹œ ì™„ë£Œ, ìˆ˜ Î¼s)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor();
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ VT1 â”‚ â”‚ VT2 â”‚ â”‚ VT3 â”‚ â”‚ VT4 â”‚ â”‚ VT5 â”‚ â”‚ VT6 â”‚  â† í™ì— ìƒì„±   â”‚
â”‚   â”‚ img1â”‚ â”‚ img2â”‚ â”‚ img3â”‚ â”‚ img4â”‚ â”‚ img5â”‚ â”‚ img6â”‚    (ê° ìˆ˜ KB)  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ìºë¦¬ì–´ ìŠ¤ë ˆë“œì— Mount & API ìš”ì²­ ì „ì†¡ (ìˆ˜ ms)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   Carrier Thread Pool (ë³´í†µ CPU ì½”ì–´ ìˆ˜ë§Œí¼, ì˜ˆ: 4ê°œ)              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚   CT1    â”‚   CT2    â”‚   CT3    â”‚   CT4    â”‚                   â”‚
â”‚   â”‚  [VT1]   â”‚  [VT2]   â”‚  [VT3]   â”‚  [VT4]   â”‚  â† 4ê°œ ë¨¼ì € Mount â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚        â”‚          â”‚          â”‚          â”‚                          â”‚
â”‚        â–¼          â–¼          â–¼          â–¼                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚         HTTP ìš”ì²­ ì „ì†¡ â†’ ì™¸ë¶€ API            â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                    â”‚
â”‚   VT5, VT6ì€ ëŒ€ê¸° íì—ì„œ ëŒ€ê¸°                                       â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: I/O ë¸”ë¡œí‚¹ â†’ Unmount (í•µì‹¬!)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   HTTP ì‘ë‹µ ëŒ€ê¸° ì‹œì‘ (blocking I/O)                               â”‚
â”‚                                                                    â”‚
â”‚   VT1: "ë‚˜ ì§€ê¸ˆ ì‘ë‹µ ê¸°ë‹¤ë ¤ì•¼ í•´" â†’ JVMì´ ê°ì§€                      â”‚
â”‚        â†“                                                           â”‚
â”‚   VT1ì˜ ìŠ¤íƒ ìƒíƒœë¥¼ í™ì— ì €ì¥ (Continuation)                        â”‚
â”‚        â†“                                                           â”‚
â”‚   VT1ì„ CT1ì—ì„œ Unmount (ë¶„ë¦¬)                                     â”‚
â”‚        â†“                                                           â”‚
â”‚   CT1ì´ ì¦‰ì‹œ VT5ë¥¼ Mount!                                          â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚   CT1    â”‚   CT2    â”‚   CT3    â”‚   CT4    â”‚                   â”‚
â”‚   â”‚  [VT5]   â”‚  [VT6]   â”‚  (idle)  â”‚  (idle)  â”‚  â† VT5,6ë„ ìš”ì²­   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                    â”‚
â”‚   VT1~VT6 ëª¨ë‘ í™ì—ì„œ ì‘ë‹µ ëŒ€ê¸° ì¤‘ (ìºë¦¬ì–´ ìŠ¤ë ˆë“œ ì ìœ  X)           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ VT1 â”‚ â”‚ VT2 â”‚ â”‚ VT3 â”‚ â”‚ VT4 â”‚ â”‚ VT5 â”‚ â”‚ VT6 â”‚               â”‚
â”‚   â”‚ ğŸ˜´  â”‚ â”‚ ğŸ˜´  â”‚ â”‚ ğŸ˜´  â”‚ â”‚ ğŸ˜´  â”‚ â”‚ ğŸ˜´  â”‚ â”‚ ğŸ˜´  â”‚  â† í™ì—ì„œ ëŒ€ê¸° â”‚
â”‚   â”‚(wait)â”‚(wait)â”‚(wait)â”‚(wait)â”‚(wait)â”‚(wait)â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                    â”‚
â”‚   ì´ ì‹œì ì— ìºë¦¬ì–´ ìŠ¤ë ˆë“œëŠ” ë‹¤ë¥¸ ì‘ì—… ê°€ëŠ¥!                          â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
                        (ì•½ 18ì´ˆ ê²½ê³¼...)
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ì‘ë‹µ ë„ì°© â†’ Mount & ì²˜ë¦¬ ì¬ê°œ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   ì™¸ë¶€ API ì‘ë‹µ ë„ì°© (ì˜ˆ: VT3 ë¨¼ì €)                                 â”‚
â”‚        â†“                                                           â”‚
â”‚   VT3: "ì‘ë‹µ ì™”ë‹¤!" â†’ JVMì´ ê°ì§€                                   â”‚
â”‚        â†“                                                           â”‚
â”‚   VT3ì„ ì‚¬ìš© ê°€ëŠ¥í•œ ìºë¦¬ì–´ ìŠ¤ë ˆë“œ(CT1)ì— Mount                      â”‚
â”‚        â†“                                                           â”‚
â”‚   í™ì—ì„œ ì €ì¥ëœ ìŠ¤íƒ ìƒíƒœ ë³µì› (Continuation)                       â”‚
â”‚        â†“                                                           â”‚
â”‚   VT3 ì‹¤í–‰ ì¬ê°œ (ì‘ë‹µ íŒŒì‹±, DTO ë³€í™˜)                              â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚   CT1    â”‚   CT2    â”‚   CT3    â”‚   CT4    â”‚                   â”‚
â”‚   â”‚  [VT3]   â”‚  [VT1]   â”‚  [VT6]   â”‚  [VT2]   â”‚  â† ì‘ë‹µ ì˜¨ ìˆœì„œë¡œ â”‚
â”‚   â”‚ ì²˜ë¦¬ì¤‘   â”‚ ì²˜ë¦¬ì¤‘    â”‚ ì²˜ë¦¬ì¤‘   â”‚ ì²˜ë¦¬ì¤‘    â”‚     Mount       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ëª¨ë“  ì²˜ë¦¬ ì™„ë£Œ â†’ ê²°ê³¼ ìˆ˜ì§‘                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   CompletableFuture.allOf(futures).join();  // ëª¨ë“  VT ì™„ë£Œ ëŒ€ê¸°   â”‚
â”‚                                                                    â”‚
â”‚   ì´ ì†Œìš” ì‹œê°„: ~18ì´ˆ (6ê±´ ë³‘ë ¬ ì²˜ë¦¬)                               â”‚
â”‚   ìˆœì°¨ ì²˜ë¦¬ì˜€ë‹¤ë©´: 18ì´ˆ Ã— 6 = 108ì´ˆ                                 â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í”Œë«í¼ ìŠ¤ë ˆë“œ vs Virtual Thread ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í”Œë«í¼ ìŠ¤ë ˆë“œ (6ê±´ ì²˜ë¦¬)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Thread 1: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚   Thread 2: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚   Thread 3: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚   Thread 4: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚   Thread 5: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚   Thread 6: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚             â†‘                   â†‘                            â†‘     â”‚
â”‚           ìš”ì²­ ì „ì†¡          I/O ëŒ€ê¸° (ë¸”ë¡œí‚¹)            ì‘ë‹µ ì²˜ë¦¬  â”‚
â”‚                                                                     â”‚
â”‚   â–ˆâ–ˆâ–ˆâ–ˆ = CPU ì‚¬ìš©    â–‘â–‘â–‘â–‘ = ë¸”ë¡œí‚¹ ëŒ€ê¸° (ìŠ¤ë ˆë“œ ìì› ì ìœ !)         â”‚
â”‚                                                                     â”‚
â”‚   ë¬¸ì œì :                                                           â”‚
â”‚   - 6ê°œ ìŠ¤ë ˆë“œê°€ ê°ê° ~1MB ìŠ¤íƒ ë©”ëª¨ë¦¬ ì ìœ                          â”‚
â”‚   - I/O ëŒ€ê¸° ì¤‘ì—ë„ OS ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ ê´€ë¦¬                            â”‚
â”‚   - ìŠ¤ë ˆë“œ í’€ í¬ê¸° ì œí•œ â†’ ë™ì‹œ ìš”ì²­ ìˆ˜ ì œí•œ                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Virtual Thread (6ê±´ ì²˜ë¦¬)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Carrier 1: â–ˆâ–ˆVT1â–ˆâ–ˆVT5â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆVT3â–ˆâ–ˆVT1â–ˆâ–ˆ                        â”‚
â”‚   Carrier 2: â–ˆâ–ˆVT2â–ˆâ–ˆVT6â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆVT4â–ˆâ–ˆVT2â–ˆâ–ˆ                        â”‚
â”‚   Carrier 3: â–ˆâ–ˆVT3â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆVT5â–ˆâ–ˆâ–‘â–‘â–‘â–‘                          â”‚
â”‚   Carrier 4: â–ˆâ–ˆVT4â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆVT6â–ˆâ–ˆâ–‘â–‘â–‘â–‘                          â”‚
â”‚              â†‘                 â†‘                                    â”‚
â”‚            ìš”ì²­ ì „ì†¡         ì‘ë‹µ ì²˜ë¦¬                              â”‚
â”‚            (Mount/Unmount)   (ë‹¤ì‹œ Mount)                           â”‚
â”‚                                                                     â”‚
â”‚   VT ìƒíƒœ: VT1~6 ëª¨ë‘ í™ì—ì„œ I/O ì™„ë£Œ ëŒ€ê¸° (ìºë¦¬ì–´ ì ìœ  X)          â”‚
â”‚                                                                     â”‚
â”‚   ì¥ì :                                                             â”‚
â”‚   - ìºë¦¬ì–´ ìŠ¤ë ˆë“œëŠ” 4ê°œë§Œ ì‚¬ìš© (CPU ì½”ì–´ ìˆ˜)                        â”‚
â”‚   - I/O ëŒ€ê¸° ì¤‘ VTëŠ” í™ ë©”ëª¨ë¦¬ë§Œ ì‚¬ìš© (ìˆ˜ KB)                       â”‚
â”‚   - ìºë¦¬ì–´ ìŠ¤ë ˆë“œê°€ ë‹¤ë¥¸ VT ì‘ì—… ì²˜ë¦¬ ê°€ëŠ¥                          â”‚
â”‚   - ìˆ˜ì²œ ê°œ ë™ì‹œ ìš”ì²­ë„ ì²˜ë¦¬ ê°€ëŠ¥                                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### I/O Bound ì‘ì—…ì—ì„œì˜ íš¨ìœ¨ì„± ìš”ì•½

| í•­ëª© | í”Œë«í¼ ìŠ¤ë ˆë“œ | Virtual Thread |
|------|--------------|----------------|
| I/O ëŒ€ê¸° ì‹œ | OS ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ìœ ì§€ | ìºë¦¬ì–´ì—ì„œ Unmount, í™ ì €ì¥ |
| ë©”ëª¨ë¦¬ | ìŠ¤ë ˆë“œë‹¹ ~1MB | VTë‹¹ ìˆ˜ KB |
| 6ê±´ ì²˜ë¦¬ ì‹œ ìŠ¤ë ˆë“œ | 6ê°œ ì ìœ  | 4ê°œ ìºë¦¬ì–´ ê³µìœ  |
| ë™ì‹œ ì²˜ë¦¬ í•œê³„ | ìŠ¤ë ˆë“œ í’€ í¬ê¸° | ì‚¬ì‹¤ìƒ ë¬´ì œí•œ |
| ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ | OS ë ˆë²¨ (ë¹„ìš© ë†’ìŒ) | JVM ë ˆë²¨ (ë¹„ìš© ë‚®ìŒ) |
| 6ê±´ ì²˜ë¦¬ ì‹œê°„ | 18ì´ˆ (ë³‘ë ¬) | 18ì´ˆ (ë³‘ë ¬) |
| ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ | I/O ëŒ€ê¸° ì¤‘ ë‚­ë¹„ | I/O ëŒ€ê¸° ì¤‘ ìì› ë°˜í™˜ |

> **í•µì‹¬**: Virtual ThreadëŠ” I/O ëŒ€ê¸° ì‹œê°„ì´ ê¸´ ì‘ì—…(ì™¸ë¶€ API í˜¸ì¶œ, DB ì¿¼ë¦¬ ë“±)ì—ì„œ **ë™ì¼í•œ ì²˜ë¦¬ ì‹œê°„ìœ¼ë¡œ í›¨ì”¬ ì ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©**í•©ë‹ˆë‹¤. ì²˜ë¦¬ëŸ‰ ì¦ê°€ê°€ ì•„ë‹Œ **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„± í–¥ìƒ**ì´ í•µì‹¬ ì´ì ì…ë‹ˆë‹¤.

---

## 3. ê¸°ë³¸ ì‚¬ìš©ë²•

### 3.1 Virtual Thread ìƒì„±

```java
// ë°©ë²• 1: Thread.startVirtualThread()
Thread vThread = Thread.startVirtualThread(() -> {
    System.out.println("Hello from Virtual Thread!");
});

// ë°©ë²• 2: Thread.ofVirtual().start()
Thread vThread2 = Thread.ofVirtual()
    .name("my-virtual-thread")
    .start(() -> {
        System.out.println("Named Virtual Thread");
    });

// ë°©ë²• 3: Thread.ofVirtual().unstarted()
Thread vThread3 = Thread.ofVirtual()
    .name("unstarted-vthread")
    .unstarted(() -> {
        System.out.println("Started later");
    });
vThread3.start();
```

### 3.2 ExecutorService í™œìš©

```java
// Virtual Thread per Task Executor (ê¶Œì¥)
try (ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor()) {

    // 100ë§Œ ê°œì˜ ì‘ì—… ì œì¶œ ê°€ëŠ¥
    IntStream.range(0, 1_000_000).forEach(i -> {
        executor.submit(() -> {
            Thread.sleep(Duration.ofSeconds(1));
            return i;
        });
    });

} // try-with-resourcesë¡œ ìë™ ì¢…ë£Œ ëŒ€ê¸°
```

### 3.3 Virtual Thread í™•ì¸

```java
Thread current = Thread.currentThread();

// Virtual Thread ì—¬ë¶€ í™•ì¸
if (current.isVirtual()) {
    System.out.println("This is a Virtual Thread");
}

// ìŠ¤ë ˆë“œ ì •ë³´ ì¶œë ¥
System.out.println(current); // VirtualThread[#21]/runnable@ForkJoinPool-1-worker-1
```

### 3.4 Structured Concurrency (Preview)

JDK 21ì—ì„œ Previewë¡œ ë„ì…ëœ êµ¬ì¡°ì  ë™ì‹œì„±:

```java
// --enable-preview í•„ìš”
try (var scope = new StructuredTaskScope.ShutdownOnFailure()) {

    Subtask<String> user = scope.fork(() -> fetchUser());
    Subtask<Integer> order = scope.fork(() -> fetchOrder());

    scope.join();           // ëª¨ë“  subtask ì™„ë£Œ ëŒ€ê¸°
    scope.throwIfFailed();  // ì˜ˆì™¸ ë°œìƒ ì‹œ ì „íŒŒ

    // ê²°ê³¼ ì‚¬ìš©
    return new Response(user.get(), order.get());
}
```

---

## 4. Spring Bootì—ì„œì˜ í™œìš©

### 4.1 ê¸°ë³¸ ì„¤ì • (Spring Boot 3.2+)

```yaml
# application.yml
spring:
  threads:
    virtual:
      enabled: true  # ì´ í•œ ì¤„ë¡œ Virtual Thread í™œì„±í™”!
  main:
    keep-alive: true  # ëª¨ë“  ìŠ¤ë ˆë“œê°€ Virtual/Daemonì¼ ë•Œ JVM ìœ ì§€
```

### 4.2 ìë™ ì„¤ì •ë˜ëŠ” í•­ëª©

`spring.threads.virtual.enabled=true` ì„¤ì • ì‹œ ìë™ ì ìš©:

| ì»´í¬ë„ŒíŠ¸ | ë™ì‘ |
|----------|------|
| **Tomcat/Jetty** | ìš”ì²­ ì²˜ë¦¬ì— Virtual Thread ì‚¬ìš© |
| **@Async** | Virtual Thread Executor ì‚¬ìš© |
| **@Scheduled** | Virtual Threadë¡œ ì‹¤í–‰ |
| **RabbitMQ Listener** | Virtual Thread Executor ì‚¬ìš© |
| **Kafka Listener** | Virtual Thread Executor ì‚¬ìš© |
| **Spring Data Redis** | ClusterCommandExecutorì— Virtual Thread ì‚¬ìš© |
| **Apache Pulsar** | VirtualThreadTaskExecutor ì‚¬ìš© |

### 4.3 ì»¤ìŠ¤í…€ TaskExecutor ì„¤ì •

```java
@Configuration
public class VirtualThreadConfig {

    @Bean
    public Executor taskExecutor() {
        return Executors.newVirtualThreadPerTaskExecutor();
    }

    // ë˜ëŠ” ThreadFactory ì‚¬ìš©
    @Bean
    public Executor customVirtualExecutor() {
        ThreadFactory factory = Thread.ofVirtual()
            .name("custom-vt-", 0)
            .factory();
        return Executors.newThreadPerTaskExecutor(factory);
    }
}
```

### 4.4 @Asyncì™€ í•¨ê»˜ ì‚¬ìš©

```java
@Service
public class AsyncService {

    @Async  // Virtual Threadì—ì„œ ì‹¤í–‰ë¨
    public CompletableFuture<String> asyncOperation() {
        // Blocking I/Oë„ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
        String result = restTemplate.getForObject(url, String.class);
        return CompletableFuture.completedFuture(result);
    }
}
```

### 4.5 WebClientì™€ì˜ ë¹„êµ

```java
// Virtual Thread ì‚¬ìš© ì‹œ - ë™ê¸° ì½”ë“œë¡œ ê°„ë‹¨í•˜ê²Œ ì‘ì„±
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) {
    // RestTemplate ì‚¬ìš© (Blockingì´ì§€ë§Œ Virtual Threadë¼ OK)
    return restTemplate.getForObject("/api/users/" + id, User.class);
}

// ê¸°ì¡´ Reactive ë°©ì‹ - ë³µì¡í•œ ì²´ì´ë‹ í•„ìš”
@GetMapping("/users/{id}")
public Mono<User> getUserReactive(@PathVariable Long id) {
    return webClient.get()
        .uri("/api/users/" + id)
        .retrieve()
        .bodyToMono(User.class);
}
```

---

## 5. Pinning ë¬¸ì œì™€ í•´ê²°

### 5.1 Pinningì´ë€?

**Pinning(ê³ ì •)**ì€ Virtual Threadê°€ Carrier Thread(Platform Thread)ì— "ê³ ì •"ë˜ì–´ ë‹¤ë¥¸ Virtual Threadê°€ í•´ë‹¹ Carrierë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤.

```
ì •ìƒ ë™ì‘:
VT1 â†’ Carrier1 (I/O ëŒ€ê¸°) â†’ Carrier1 ë°˜í™˜ â†’ ë‹¤ë¥¸ VT ì‹¤í–‰ ê°€ëŠ¥

Pinning ë°œìƒ:
VT1 â†’ Carrier1 (synchronized ë‚´ I/O) â†’ Carrier1 ì ìœ  ìœ ì§€ âŒ
â†’ Carrier Thread Pool ê³ ê°ˆ ê°€ëŠ¥!
```

### 5.2 JDK 21ì—ì„œì˜ Pinning ì›ì¸

1. **synchronized ë¸”ë¡/ë©”ì„œë“œ ë‚´ Blocking ì‘ì—…**
2. **Native ì½”ë“œ ì‹¤í–‰ (JNI, FFM API)**

```java
// Pinning ë°œìƒ ì˜ˆì‹œ (JDK 21)
synchronized (lock) {
    // ì´ ì•ˆì—ì„œ Blocking I/O ìˆ˜í–‰ ì‹œ Pinning!
    Thread.sleep(1000);
    httpClient.send(request, handler);
}
```

### 5.3 JDK 21ì—ì„œì˜ í•´ê²° ë°©ë²•

```java
// í•´ê²°ì±… 1: ReentrantLock ì‚¬ìš©
private final ReentrantLock lock = new ReentrantLock();

public void safeMethod() {
    lock.lock();
    try {
        // Blocking I/O ìˆ˜í–‰ - Pinning ë°œìƒ ì•ˆ í•¨
        Thread.sleep(1000);
    } finally {
        lock.unlock();
    }
}

// í•´ê²°ì±… 2: synchronized ë²”ìœ„ ìµœì†Œí™”
public void optimizedMethod() {
    Data data;
    synchronized (lock) {
        data = prepareData();  // ë¹ ë¥¸ ì‘ì—…ë§Œ
    }
    // Blocking ì‘ì—…ì€ synchronized ë°–ì—ì„œ
    sendData(data);
}
```

### 5.4 Pinning ê°ì§€

```bash
# JVM ì˜µì…˜ìœ¼ë¡œ Pinning ê°ì§€
java -Djdk.tracePinnedThreads=full MyApplication

# ë˜ëŠ” short ëª¨ë“œ
java -Djdk.tracePinnedThreads=short MyApplication
```

ì¶œë ¥ ì˜ˆì‹œ:
```
Thread[#24,ForkJoinPool-1-worker-1,5,CarrierThreads]
    java.base/java.lang.VirtualThread$VThreadContinuation.onPinned(VirtualThread.java:185)
    java.base/java.lang.VirtualThread.park(VirtualThread.java:582)
    java.base/java.lang.System$2.parkVirtualThread(System.java:2643)
    java.base/jdk.internal.misc.VirtualThreads.park(VirtualThreads.java:54)
    java.base/java.util.concurrent.locks.LockSupport.park(LockSupport.java:219)
    ...
```

### 5.5 JDK 24: Pinning ë¬¸ì œ í•´ê²°! (JEP 491)

**JDK 24ë¶€í„° synchronized ë¸”ë¡ì—ì„œ Pinningì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**

```java
// JDK 24+ : ì´ì œ ì•ˆì „í•¨!
synchronized (lock) {
    Thread.sleep(1000);  // Pinning ì—†ìŒ
    httpClient.send(request, handler);  // Pinning ì—†ìŒ
}
```

> **JEP 491 ì ìš© í›„:**
> - Virtual Threadê°€ synchronized ë‚´ì—ì„œ blockë˜ë©´ Carrier Thread ë°˜í™˜
> - ë‹¤ë¥¸ Platform Threadê°€ ë‚˜ì¤‘ì— ì‘ì—… ì¬ê°œ ê°€ëŠ¥
> - **ì•½ 98% ì„±ëŠ¥ í–¥ìƒ** (Pinningì´ ë§ë˜ ì›Œí¬ë¡œë“œ ê¸°ì¤€)

### 5.6 ë‚¨ì•„ìˆëŠ” Pinning ì¼€ì´ìŠ¤ (JDK 24+)

```java
// ì—¬ì „íˆ Pinning ë°œìƒ
// 1. Native ë©”ì„œë“œ í˜¸ì¶œ
public native void nativeMethod();

// 2. Foreign Function & Memory API ì‚¬ìš©
try (Arena arena = Arena.ofConfined()) {
    // FFM ì‘ì—… ì¤‘ Pinning ê°€ëŠ¥
}
```

---

## 6. ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 6.1 DO (ê¶Œì¥ì‚¬í•­)

```java
// âœ… Virtual Thread per Task Executor ì‚¬ìš©
ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor();

// âœ… try-with-resourcesë¡œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    executor.submit(task);
}

// âœ… I/O ë°”ìš´ë“œ ì‘ì—…ì— í™œìš©
executor.submit(() -> {
    var response = httpClient.send(request, handler);
    repository.save(parseResponse(response));
});

// âœ… JDK 21ì—ì„œëŠ” ReentrantLock ê³ ë ¤ (JDK 24+ëŠ” ë¶ˆí•„ìš”)
private final ReentrantLock lock = new ReentrantLock();
```

### 6.2 DON'T (ì£¼ì˜ì‚¬í•­)

```java
// âŒ Virtual Threadë¥¼ í’€ë§í•˜ì§€ ë§ˆì„¸ìš”
ExecutorService pool = Executors.newFixedThreadPool(100,
    Thread.ofVirtual().factory());  // ì˜ë¯¸ ì—†ìŒ!

// âŒ ThreadLocal ë‚¨ìš© ê¸ˆì§€ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìœ„í—˜)
private static final ThreadLocal<ExpensiveObject> cache =
    ThreadLocal.withInitial(ExpensiveObject::new);
// ìˆ˜ë°±ë§Œ Virtual Thread Ã— ExpensiveObject = ë©”ëª¨ë¦¬ í­ë°œ!

// âŒ CPU ì§‘ì•½ì  ì‘ì—…ì— ì‚¬ìš© ê¸ˆì§€
executor.submit(() -> {
    // CPU ë°”ìš´ë“œ ì‘ì—… - ì´ì  ì—†ìŒ
    return fibonacci(1000000);
});

// âŒ synchronized ë‚´ ì¥ì‹œê°„ Blocking (JDK 21)
synchronized (lock) {
    Thread.sleep(10_000);  // JDK 24 ì´ì „ì—ì„œëŠ” í”¼í•˜ì„¸ìš”
}
```

### 6.3 ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

```
1ë‹¨ê³„: í™˜ê²½ ì¤€ë¹„
   â””â”€â”€ JDK 21+ ì—…ê·¸ë ˆì´ë“œ
   â””â”€â”€ Spring Boot 3.2+ ì—…ê·¸ë ˆì´ë“œ

2ë‹¨ê³„: ì„¤ì • í™œì„±í™”
   â””â”€â”€ spring.threads.virtual.enabled=true

3ë‹¨ê³„: ëª¨ë‹ˆí„°ë§
   â””â”€â”€ Pinning ê°ì§€ ë¡œê·¸ í™œì„±í™”
   â””â”€â”€ Micrometer ë©”íŠ¸ë¦­ ì„¤ì •

4ë‹¨ê³„: ì½”ë“œ ìµœì í™”
   â””â”€â”€ synchronized â†’ ReentrantLock (JDK 21)
   â””â”€â”€ ThreadLocal ì‚¬ìš© ê²€í† 

5ë‹¨ê³„: JDK 24 ì—…ê·¸ë ˆì´ë“œ (ê¶Œì¥)
   â””â”€â”€ Pinning ë¬¸ì œ ì™„ì „ í•´ê²°
   â””â”€â”€ synchronized ì½”ë“œ ìœ ì§€ ê°€ëŠ¥
```

### 6.4 ThreadLocal ëŒ€ì•ˆ

```java
// âŒ ê¸°ì¡´ ë°©ì‹ - Virtual Threadì—ì„œ ë¹„íš¨ìœ¨ì 
private static final ThreadLocal<SimpleDateFormat> formatter =
    ThreadLocal.withInitial(() -> new SimpleDateFormat("yyyy-MM-dd"));

// âœ… ëŒ€ì•ˆ 1: Immutable ê°ì²´ ì‚¬ìš©
private static final DateTimeFormatter formatter =
    DateTimeFormatter.ofPattern("yyyy-MM-dd");

// âœ… ëŒ€ì•ˆ 2: ì§€ì—­ ë³€ìˆ˜ë¡œ ì‚¬ìš©
public String format(LocalDate date) {
    DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd");
    return date.format(formatter);
}

// âœ… ëŒ€ì•ˆ 3: Scoped Values (Preview in JDK 21+)
private static final ScopedValue<User> CURRENT_USER = ScopedValue.newInstance();

ScopedValue.where(CURRENT_USER, user).run(() -> {
    // CURRENT_USER.get()ìœ¼ë¡œ ì ‘ê·¼
});
```

---

## 7. ì„±ëŠ¥ ë° ëª¨ë‹ˆí„°ë§

### 7.1 ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ (ì°¸ê³ ìš©)

| ì‹œë‚˜ë¦¬ì˜¤ | Platform Thread | Virtual Thread | ê°œì„ ìœ¨ |
|----------|-----------------|----------------|--------|
| 500 ë™ì‹œ ì‚¬ìš©ì, 1000 ìš”ì²­ | ê¸°ì¤€ | ~2ë°° í–¥ìƒ | 100% |
| I/O ëŒ€ê¸° ë§ì€ ì›Œí¬ë¡œë“œ | ê¸°ì¤€ | ~5-10ë°° í–¥ìƒ | 400-900% |
| CPU ì§‘ì•½ì  ì›Œí¬ë¡œë“œ | ê¸°ì¤€ | ë™ì¼ ë˜ëŠ” ì•½ê°„ ì €í•˜ | 0% |

### 7.2 Micrometer ë©”íŠ¸ë¦­ ì„¤ì •

```java
@Configuration
public class VirtualThreadMetricsConfig {

    @Bean
    public MeterBinder virtualThreadMetrics() {
        return registry -> {
            Gauge.builder("jvm.threads.virtual",
                    () -> Thread.getAllStackTraces().keySet().stream()
                        .filter(Thread::isVirtual)
                        .count())
                .description("Number of virtual threads")
                .register(registry);
        };
    }
}
```

### 7.3 JFR(Java Flight Recorder) í™œìš©

```bash
# JFR ì‹œì‘
java -XX:StartFlightRecording=filename=recording.jfr,duration=60s \
     -jar myapp.jar

# ì£¼ìš” ì´ë²¤íŠ¸
# - jdk.VirtualThreadStart
# - jdk.VirtualThreadEnd
# - jdk.VirtualThreadPinned
# - jdk.VirtualThreadSubmitFailed
```

---

## 8. ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [JEP 444: Virtual Threads](https://openjdk.org/jeps/444)
- [JEP 491: Synchronize Virtual Threads without Pinning](https://openjdk.org/jeps/491)
- [Oracle Virtual Threads Documentation](https://docs.oracle.com/en/java/javase/21/core/virtual-threads.html)

### Spring ê´€ë ¨
- [Spring Boot 3.2 Release Notes](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.2-Release-Notes)
- [Working with Virtual Threads in Spring - Baeldung](https://www.baeldung.com/spring-6-virtual-threads)

### ì‹¬í™” í•™ìŠµ
- [Java Virtual Threads: A Case Study - InfoQ](https://www.infoq.com/articles/java-virtual-threads-a-case-study/)
- [JDK 24's Major Improvement: Virtual Threads Without Pinning](https://www.danvega.dev/blog/jdk-24-virtual-threads-without-pinning)
- [Java 24 Thread Pinning Revisited](https://mikemybytes.com/2025/04/09/java24-thread-pinning-revisited/)

---

## ìš”ì•½

| í•­ëª© | í•µì‹¬ ë‚´ìš© |
|------|-----------|
| **ì •ì‹ ë¦´ë¦¬ìŠ¤** | JDK 21 (LTS) - JEP 444 |
| **Spring ì§€ì›** | Spring Boot 3.2+ |
| **í™œì„±í™” ë°©ë²•** | `spring.threads.virtual.enabled=true` |
| **ì í•©í•œ ì¼€ì´ìŠ¤** | I/O ë°”ìš´ë“œ ì‘ì—…, ëŒ€ëŸ‰ ë™ì‹œ ìš”ì²­ |
| **ì£¼ì˜ì‚¬í•­** | ThreadLocal ë‚¨ìš©, CPU ì‘ì—… ì‚¬ìš© |
| **Pinning í•´ê²°** | JDK 24 (JEP 491)ë¡œ synchronized ë¬¸ì œ í•´ê²° |

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025ë…„ 12ì›” (I/O Bound ë™ì‘ í”Œë¡œìš° ì¶”ê°€)*
